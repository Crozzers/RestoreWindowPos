name: Tests

on:
  push:
    paths:
      src/*
      .github/*
      test/*
      tools/*
    tags-ignore:
      - '*'
  pull_request:
  workflow_dispatch:

jobs:
  test:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      - name: Install Python dependencies
        run: |
          python -m pip install -r requirements-dev.txt
      - name: Python Tests
        run: pytest --verbose
      - name: Install build tools
        run: |
          choco install nsis upx -y
      - name: Build package
        run: |
          tools\compile.bat
      - name: Test Installer
        run: |
          tools\test-installer.ps1 -confirm y
